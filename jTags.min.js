(function($){$.fn.textWalk=function(e,t){var n=[];for(var r=this.get(0).childNodes.length;r-->0;){var i=this.get(0).childNodes[r];if(i.nodeType==1){var s=i.tagName.toLowerCase();if(s!=="script"&&s!=="style"&&s!=="textarea"){$(i).textWalk(e,t)}}else if(i.nodeType==3){if(typeof e==="string"){var o=0;while(true){o=i.data.indexOf(e,o);if(o===-1)break;n.push({index:o,0:e})}}else{var u;while(u=e.exec(i.data))n.push(u)}for(var a=n.length;a-->0;)t.call(window,i,n[a])}}};$(window).load(function(){$.j.extensions.repeater=function(){var e=$(this).html();$(this).html("");for(var t=0;t<$(this).attr("times");t++){$(this).append(e)}$(this).jend()};$.j()});$.j=function(){if($.j.status==true)return;$.j.status=true;var e="";var t="a";var n=$.j.extensions;debugger;while(e!==t){e=$("html").html();var r="";for(var i in n){if(n.hasOwnProperty(i)){r+=i+","}}r=r.substr(0,r.length-1);$(r).each(function(e,t){if($(t).parents(r).length==0&&typeof $(t).attr("skip")==="undefined"){$(t).trigger("jstart");n[$(t).prop("tagName").toLowerCase()].call(t);$(t).trigger("jstop");if(typeof $(t).attr("skip")==="undefined")$(t).attr("skip","true")}if(typeof $(t).attr("skip")!=="undefined"){if(!isNaN($(t).attr("skip"))&&$(t).attr("skip")>1)$(t).attr("skip",$(t).attr("skip")-1);else if($(t).attr("skip")==1)$(t).attr("skip","once");else if($(t).attr("skip")=="once")$(t).removeAttr("skip")}});t=$("html").html()}$.j.status=false};$.fn.jend=function(e){$(this).trigger("jend");if(typeof e!=="undefined")$(this).replaceWith(e);else $(this).replaceWith($(this).contents());$.j()};$.j.extensions={extension:function(){function add(){try{f=eval("["+f+"]")[0]}catch(v){return}$.j.extensions[name]=f;$(e).jend()}var e=this;if(!$(e).is("[name]"))return;var name=$(e).attr("name");var f=null;if($(e).is("[source]")){f=$(e).html();add()}else{$.get($(e).attr("source"),function(e){f=e;add()})}$(e).jend()},j:function(){try{eval($(this).attr("code"))}catch(e){$(this).jend()}},load:function(){var e=this;if($(e).is("[action]"))$(e).load($(e).attr("action"),function(t,n,r){if(n=="success")$(e).jend()})},"define-fragment":function(){function n(){t=$(e).contents().clone(true);$.j.fragments[$(e).attr("name")]=t;$(e).jend("")}$(this).hide();if(!$(this).is("[name]")){$(this).jend();return}var e=this;var t="";if(!$.j.fragments)$.j.fragments={};if($(e).is("[source]")){$(e).load($(e).attr("source"),function(e,t,r){if(t=="success")n()})}else n()},fragment:function(){function t(){$(e).html("");$(e).append($.j.fragments[$(e).attr("name")].clone(true));var t=/{%(\w+) *(\[(?:.|\r|\n)*?\])? *%}/gm;$(e).textWalk(t,function(t,n){var r="error: no value could be found for parameter: `"+n[1]+"`";if(n[2])r=n[2].substr(1,n[2].length-2);if($(e).is("["+n[1]+"]"))r=$(e).attr(n[1]);if($(e).data("fragment-data")&&$(e).data("fragment-data")[n[1]])r=$(e).data("fragment-data")[n[1]];t.data=t.data.replace(n[0],r)});$(e).jend()}if(!$(this).is("[name]")||!$.j.fragments){$(this).jend();return}if(!$.j.fragments[$(this).attr("name")]){$(this).attr("skip","once");return}var e=this;if($(e).is("[source]")){$.getJSON($(e).attr("source"),function(n){$(e).data("fragment-data",$.extend($(e).data("fragment-data"),n));t()}).error(function(){t()})}else t()},repeater:function(){function t(){var t=$(e).data("repeater-data");if(t)var n=t.length;if($(e).is("[times]")&&!isNaN($(e).is("[times]")))n=$(e).attr("times");var r=$(e).contents();$(e).html("");for(var i=0;i<n;i++){var s=r.clone(true);$(s).filter("fragment").each(function(n,r){if(t&&t[i])$(r).data("fragment-data",$.extend($(e).data("fragment-data"),t[i]))});$(e).append(s)}$(e).jend()}e=this;if($(e).is("[source]")){$.getJSON($(e).attr("source"),function(n){debugger;$(e).data("repeater-data",$.extend($(e).data("repeater-data"),n));t()}).error(function(){debugger;t()})}else t()},"content-holder":function(){function t(){$.get(n("page"),function(e){$(e).filter("content[name]").each(function(e,t){$("div#j-content-holder-"+$(t).attr("name")).html("").append($(t).contents().clone(true))});$.j()})}function n(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return n==null?"":decodeURIComponent(n[1].replace(/\+/g," "))}if(!$(this).is("[name]")){$(this).jend();return}var e=this;$(e).wrap('<div id="j-content-holder-'+$(e).attr("name")+'"></div>');$(e).jend();if(n("page"))t();$("body").on("click","a[href]:not([rel=external])",function(e){e.preventDefault();window.history.pushState("object or string","Title","?page="+$(this).attr("href"));t()});window.onpopstate=t}};$.j.status=""})(jQuery)
